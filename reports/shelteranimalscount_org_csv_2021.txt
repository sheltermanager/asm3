shelteranimalscount.org monthly CSV export 2021
###
Figures
###
33600/PostgreSQL rev08
###
When run from Export Reports as CSV, produces a file containing one month of data for importing into shelteranimalscount.org
###
en
###
$VAR from DATE Enter from date$
$VAR to DATE Enter to date$

$CONST CANINES=1$
$CONST FELINES=2$
$CONST RABBITS=7$
$CONST EQUINES=24,25,26$
$CONST SMALLMAMMALS=4,5,9,10,18,20,22$
$CONST FARMANIMALS=16,27,28$
$CONST BIRDS=3,14,15,17$
$CONST REPTILES=11,12,13$

-- requires that you have a Surrender entry category for surrenders
-- requires that you have a Stray entry category for strays
-- requires that you have a TNR entry category to exclude TNR from Return To Field
-- requires that you have state set for your org under Settings->Options->Shelter Details
-- relies on the original ASM species IDs. You will need to edit constants above if you changed them.


-- CANINES 

SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'canine' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($CANINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($CANINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($CANINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($CANINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($CANINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($CANINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown",

1 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader

-- END OF SPECIES



-- FELINES 

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'feline' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($FELINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($FELINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($FELINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($FELINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($FELINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($FELINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown",

2 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES



-- RABBITS 

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'rabbit' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($RABBITS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($RABBITS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($RABBITS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($RABBITS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($RABBITS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown",

3 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES




-- EQUINES 

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'equine' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($EQUINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($EQUINES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($EQUINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($EQUINES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($EQUINES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown",

4 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES




-- SMALL MAMMALS 

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'small_mammal' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($SMALLMAMMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown", 

5 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES



-- FARM ANIMALS 

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'farm_animal' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($FARMANIMALS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($FARMANIMALS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($FARMANIMALS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($FARMANIMALS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($FARMANIMALS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown",

6 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES



-- BIRDS

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'bird' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($BIRDS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($BIRDS$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($BIRDS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($BIRDS$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($BIRDS$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown", 

7 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES




-- REPTILES

UNION SELECT 

extract(YEAR FROM DATE '$@from$')::integer AS "Record Year",
extract(MONTH FROM DATE '$@from$')::integer AS "Record Month",
'reptile_or_amphibian' AS Species, 

TO_CHAR('$@from$'::timestamp, 'YYYY-MM-DD') AS "Beginning Count Date",
TO_CHAR('$@to$'::timestamp, 'YYYY-MM-DD') AS "Ending Count Date",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($REPTILES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate < '$@from$' AND (ReturnDate Is Null OR ReturnDate >= '$@from$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn < '$@from$'
AND NonShelterAnimal = 0
AND SpeciesID IN ($REPTILES$)
AND (DeceasedDate Is Null OR DeceasedDate >= '$@from$')) AS "Beginning Foster Animal Count",

(SELECT COUNT(*) FROM animal WHERE 
NOT EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType NOT IN (2,8) AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0 AND IsDOA = 0
AND SpeciesID IN ($REPTILES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Count",

(SELECT COUNT(*) FROM animal WHERE 
EXISTS (SELECT MovementDate FROM adoption WHERE MovementDate <= '$@to$' AND (ReturnDate Is Null OR ReturnDate > '$@to$') AND MovementType = 2 AND AnimalID = animal.ID)
AND DateBroughtIn <= '$@to$ 23:59:59'
AND NonShelterAnimal = 0
AND SpeciesID IN ($REPTILES$)
AND (DeceasedDate Is Null OR DeceasedDate > '$@to$')) AS "Ending Foster Animal Count",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Stray%' AND IsTransfer = 0 AND CrueltyCase = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Stray At Large Up To 5 Months",

0 AS "Stray At Large Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < ReturnDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) +
(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType IN (1,5)
AND ReturnDate >= '$@from$' AND ReturnDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) 
AS "Relinquished By Owner Up To 5 Months",

0 AS "Relinquished By Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID = 0 OR (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) = 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Instate Agency Up To 5 Months",

0 AS "Transferred In From Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months'
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE IsTransfer = 1 AND CrueltyCase = 0
AND (animal.BroughtInByOwnerID <> 0 AND (SELECT OwnerCounty FROM owner WHERE ID = animal.BroughtInByOwnerID) <> 
(SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty'))
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred In From Out Of State Agency Up To 5 Months",

0 AS "Transferred In From Out Of State Agency Age Unknown",
0 AS "Transferred In From International Agency Adult",
0 AS "Transferred In From International Agency Up To 5 Months",
0 AS "Transferred In From International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 0
AND AsilomarOwnerRequestedEuthanasia = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Intake Owner-Intended Euthanasia Up To 5 Months",

0 AS "Intake Owner-Intended Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE OriginalOwnerID > 0 AND IsTransfer = 0 AND CrueltyCase = 1
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Seized Or Impounded Up To 5 Months",

0 AS "Seized Or Impounded Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Adult",

(SELECT COUNT(*) FROM animal 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE ReasonName NOT LIKE '%Surrender%' AND IsTransfer = 0 AND CrueltyCase = 0 AND ReasonName NOT LIKE '%Stray%' AND ReasonName NOT LIKE '%TNR%'
AND AsilomarOwnerRequestedEuthanasia = 0
AND DateBroughtIn >= '$@from$' AND DateBroughtIn <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DateBroughtIn - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Intakes Up To 5 Months",

0 AS "Other Intakes Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 1
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Adoption Up To 5 Months",

0 AS "Adoption Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
WHERE MovementType = 5
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Owner Up To 5 Months",

0 AS "Returned To Owner Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty = (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Instate Agency Up To 5 Months",

0 AS "Transferred Out To Instate Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN owner ON owner.ID = adoption.OwnerID
WHERE MovementType = 3
AND owner.OwnerCounty <> (SELECT ItemValue FROM configuration WHERE ItemName = 'OrganisationCounty')
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Transferred Out To Out Of State Agency Up To 5 Months",

0 AS "Transferred Out To Out Of State Agency Age Unknown",
0 AS "Transferred Out To International Agency Adult",
0 AS "Transferred Out To International Agency Up To 5 Months",
0 AS "Transferred Out To International Agency Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName NOT LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Returned To Field Up To 5 Months",

0 AS "Returned To Field Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType = 7 AND ReasonName LIKE '%TNR%'
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Other Live Outcome Up To 5 Months",

0 AS "Other Live Outcome Age Unknown",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Adult",

(SELECT COUNT(*) FROM animal
INNER JOIN adoption ON animal.ID = adoption.AnimalID 
INNER JOIN entryreason ON entryreason.ID = animal.EntryReasonID
WHERE MovementType IN (4, 6)
AND MovementDate >= '$@from$' AND MovementDate <= '$@to$' 
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= MovementDate - INTERVAL '5 months' 
AND NonShelterAnimal = 0) AS "Lost In Care Up To 5 Months",

0 AS "Lost In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Died In Care Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0 AND IsDOA = 0 
AND PutToSleep = 0 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Died In Care Up To 5 Months",

0 AS "Died In Care Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 0
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Shelter Euthanasia Up To 5 Months",

0 AS "Shelter Euthanasia Age Unknown",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth < DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Adult",

(SELECT COUNT(*) FROM animal 
WHERE DeceasedDate >= '$@from$' AND DeceasedDate <= '$@to$'
AND NonShelterAnimal = 0 AND DiedOffShelter = 0
AND PutToSleep = 1 AND AsilomarOwnerRequestedEuthanasia = 1
AND SpeciesID IN ($REPTILES$)
AND DateOfBirth >= DeceasedDate - INTERVAL '5 months') AS "Outcome Owner-Intended Euthanasia Up To 5 Months",

0 AS "Outcome Owner-Intended Euthanasia Age Unknown", 

8 AS Ordering,
1 AS TitleCaseHeader,
'Transferred In From Out Of State Agency Adult=Transferred In From Out of State Agency Adult,Transferred In From Out Of State Agency Up To 5 Months=Transferred In From Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Adult=Transferred Out To Out of State Agency Adult,Transferred Out To Out Of State Agency Up To 5 Months=Transferred Out To Out of State Agency Up To 5 Months,Transferred Out To Out Of State Agency Age Unknown=Transferred Out To Out of State Agency Age Unknown,Transferred In From Out Of State Agency Age Unknown=Transferred In From Out of State Agency Age Unknown' AS RenameHeader


-- END OF SPECIES


ORDER BY Ordering


###
$$HEADER
HEADER$$

$$BODY
BODY$$

$$FOOTER
<p>This report should be run from <a href="report_export">Settings-&gt;Export Reports as CSV</a> with one calendar month selected to produce a file for uploading to shelteranimalscount.org</p>
FOOTER$$
